<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>学生转化管理系统</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/v3.2.8/vue.global.prod.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <div id="app">
        <!-- 顶部导航栏 -->
        <div class="top-nav">
            <div class="nav-left">
                <div class="brand-logo">
                    <img src="https://m.xiwang.com/resources/xiwang-silogan-transp-4JVkSwWn3xyyRXxbblADB.png" alt="希望学" class="logo-image">
                </div>
                <div class="nav-divider"></div>
                <h1 class="nav-title">初中大Leads意向度</h1>
            </div>
            <div class="nav-right">
                <div class="user-info">
                    <div class="user-avatar">
                        <img :src="currentUser.avatar" :alt="currentUser.name">
                    </div>
                    <span class="user-name">{{ currentUser.name }}</span>
                </div>
            </div>
        </div>
        
        <!-- 主内容区域 -->
        <div class="main-container">
            <!-- 顶部统计卡片 -->
            <div class="stats-cards">
                <div class="stat-card stat-card-1">
                    <div class="stat-label">B+学员（未转化）</div>
                    <div class="stat-value">{{ stats.bPlus }}个</div>
                    <div class="stat-percent">占比{{ stats.bPlusPercent }}%</div>
                </div>
                <div class="stat-card stat-card-2">
                    <div class="stat-label">B学员（未转化）</div>
                    <div class="stat-value">{{ stats.b }}个</div>
                    <div class="stat-percent">占比{{ stats.bPercent }}%</div>
                </div>
                <div class="stat-card stat-card-3">
                    <div class="stat-label">B-学员（未转化）</div>
                    <div class="stat-value">{{ stats.bMinus }}个</div>
                    <div class="stat-percent">占比{{ stats.bMinusPercent }}%</div>
                </div>
                <div class="stat-card stat-card-4">
                    <div class="stat-label">已转化学员</div>
                    <div class="stat-value">{{ stats.converted }}个</div>
                    <div class="stat-percent">转化率{{ stats.conversionRate }}%</div>
                </div>
            </div>


            <!-- 搜索筛选区域 -->
            <div class="filter-bar">
                <div class="filter-item">
                    <label>姓名</label>
                    <div class="input-with-icon">
                        <input type="text" v-model="filters.name" placeholder="请输入姓名" @keyup.enter="search">
                        <span class="icon-search">🔍</span>
                    </div>
                </div>
                <div class="filter-item">
                    <label>电话</label>
                    <div class="input-with-icon">
                        <input type="text" v-model="filters.phone" placeholder="请输入电话" @keyup.enter="search">
                        <span class="icon-search">🔍</span>
                    </div>
                </div>
                <div class="filter-item">
                    <label>学员ID</label>
                    <div class="input-with-icon">
                        <input type="text" v-model="filters.studentId" placeholder="请输入学员ID" @keyup.enter="search">
                        <span class="icon-search">🔍</span>
                    </div>
                </div>
                <div class="filter-item">
                    <label>意向度</label>
                    <select v-model="filters.intention" class="select-input">
                        <option value="">全部</option>
                        <option value="bPlus">B+学员</option>
                        <option value="b">B学员</option>
                        <option value="bMinus">B-学员</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>转化状态</label>
                    <select v-model="filters.converted" class="select-input">
                        <option value="">全部</option>
                        <option value="true">已转化</option>
                        <option value="false">未转化</option>
                    </select>
                </div>
                <button class="search-btn-new" @click="search">查询</button>
                <button class="reset-btn" @click="resetFilters">重置</button>
            </div>

            <!-- 学生卡片列表 -->
            <div class="cards-container">
                <!-- 加载状态 -->
                <div v-if="loading" class="loading">
                    <div class="spinner"></div>
                    <p>正在加载中...</p>
                </div>

                <!-- 空状态 -->
                <div v-else-if="displayStudents.length === 0" class="empty-state">
                    <div style="font-size: 60px; margin-bottom: 20px;">📚</div>
                    <p>暂无学生数据</p>
                </div>

                <!-- 学生卡片 -->
                <div v-else class="student-cards">
                    <div 
                        v-for="student in displayStudents" 
                        :key="student.id" 
                        class="student-card"
                    >
                        <div class="card-header">
                            <div class="card-left">
                                <div class="student-avatar-large">
                                    <img :src="student.avatar" :alt="student.name">
                                </div>
                                <div class="student-basic">
                                    <div class="student-name-large">{{ student.name }}</div>
                                    <div class="student-tags">
                                        <span class="tag tag-grade">{{ student.grade }}</span>
                                        <span class="tag tag-gender">{{ student.gender }}</span>
                                        <span class="tag tag-city">{{ student.city }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-right">
                                <div 
                                    class="level-badge"
                                    :class="getLevelClass(student.probability)"
                                >
                                    {{ getLevelLabel(student.probability) }}
                                </div>
                            </div>
                        </div>
                        <div class="card-info">
                            <div class="info-item">
                                <span class="info-label">学生ID：</span>
                                <span class="info-value">{{ student.id }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">课程名称：</span>
                                <span class="info-value">{{ student.courseName }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">意向度：</span>
                                <span class="info-value probability-text" :class="getProbabilityClass(student.probability)">
                                    {{ student.probability }}%
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">转化状态：</span>
                                <span class="info-value" :class="student.converted ? 'converted-yes' : 'converted-no'">
                                    {{ student.converted ? '已转化' : '未转化' }}
                                </span>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn action-btn-secondary" @click="callPhone(student.phone)">
                                📞 电话联系
                            </button>
                            <button class="action-btn action-btn-secondary" @click="contactWechat(student.id)">
                                💬 企微联系
                            </button>
                            <button class="action-btn action-btn-primary" @click="navigateToDetail(student.id)">
                                查看详情
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 分页 -->
            <div v-if="!loading && displayStudents.length > 0" class="pagination">
                <button 
                    class="page-btn" 
                    :disabled="currentPage === 1"
                    @click="changePage(currentPage - 1)"
                >
                    ‹
                </button>
                <button 
                    v-for="page in visiblePages" 
                    :key="page"
                    class="page-btn"
                    :class="{ active: page === currentPage }"
                    @click="changePage(page)"
                >
                    {{ page }}
                </button>
                <button 
                    class="page-btn"
                    :disabled="currentPage === totalPages"
                    @click="changePage(currentPage + 1)"
                >
                    ›
                </button>
            </div>
        </div>
        
        <!-- 右侧悬浮排行榜 -->
        <div class="floating-ranking" :class="{ collapsed: rankingCollapsed }">
            <div class="floating-ranking-header" @click="toggleRanking">
                <span class="ranking-icon">🏆</span>
                <span v-if="!rankingCollapsed" class="ranking-title-text">转化率排行</span>
                <button class="collapse-btn" @click.stop="toggleRanking">
                    {{ rankingCollapsed ? '‹' : '›' }}
                </button>
            </div>
            <div class="floating-ranking-content">
                <div class="top3-section">
                    <div v-for="(item, index) in topRanking" :key="item.id" class="mini-rank-item">
                        <div class="mini-medal" :class="'medal-' + (index + 1)">{{ index + 1 }}</div>
                        <div class="mini-teacher">{{ item.name }}</div>
                        <div class="mini-rate">{{ item.conversionRate }}%</div>
                    </div>
                </div>
                <div class="my-rank-section">
                    <div class="my-rank-label">我的排名</div>
                    <div class="my-rank-value">第{{ myRanking.rank }}名 · {{ myRanking.conversionRate }}%</div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
